<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>message board</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#121212] text-[#E0E0E0] min-h-screen font-sans">

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö -->
  <div class="absolute top-4 left-6 z-50">
    <a href="{{ url_for('opening') }}" class="text-3xl text-white hover:text-red-400">&lt;</a>
  </div>

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ -->
  <button onclick="toggleForm()" title="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ"
          class="fixed bottom-6 right-6 w-14 h-14 rounded-full bg-red-600 text-white text-3xl shadow-lg hover:bg-red-700 z-50">
    +
  </button>

  <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ -->
  <div id="formOverlay"
       class="fixed inset-0 bg-[#121212]/95 z-50 flex justify-center items-center p-4 overflow-auto opacity-0 pointer-events-none transition-opacity duration-300">
    <form method="POST" enctype="multipart/form-data" 
          class="w-full max-w-lg bg-[#1f1f1f] text-gray-200 rounded-xl shadow-lg p-6 relative max-h-[90vh] overflow-y-auto"
          autocomplete="off">
      <!-- ... -->
<form method="POST" enctype="multipart/form-data" 
      class="w-full max-w-lg bg-[#1f1f1f] text-gray-200 rounded-xl shadow-lg p-6 relative max-h-[90vh] overflow-y-auto"
      autocomplete="off">
  <button type="button" onclick="toggleForm()" 
          class="absolute top-3 right-3 text-3xl font-bold text-gray-400 hover:text-red-500" 
          aria-label="‡∏õ‡∏¥‡∏î‡∏ü‡∏≠‡∏£‡πå‡∏°">&times;</button>

  <h2 class="text-2xl font-bold text-red-500 mb-6 text-center">‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ</h2>

  <div class="mb-5">
    <label for="title" class="block mb-1 font-semibold">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ</label>
    <input id="title" name="title" type="text" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ñ‡∏ô‡∏ô‡∏Ç‡∏£‡∏∏‡∏Ç‡∏£‡∏∞‡πÉ‡∏ô‡∏ã‡∏≠‡∏¢..." 
           class="w-full bg-[#2a2a2a] border border-[#444] rounded-md p-3 text-gray-100 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500" />
  </div>

  <div class="mb-5">
    <label for="content" class="block mb-1 font-semibold">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
    <textarea id="content" name="content" rows="5" required placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î"
              class="w-full bg-[#2a2a2a] border border-[#444] rounded-md p-3 text-gray-100 resize-none placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500"></textarea>
  </div>

  <!-- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß multiple ‡πÄ‡∏õ‡πá‡∏ô 3 ‡∏ä‡πà‡∏≠‡∏á‡πÅ‡∏¢‡∏Å -->
  <div class="mb-5">
    <label class="block mb-2 font-semibold">‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏µ‡∏î‡∏µ‡πÇ‡∏≠ (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 3 ‡πÑ‡∏ü‡∏•‡πå)</label>
    <input type="file" name="file1" accept="image/*,video/*" 
           class="w-full mb-3 bg-[#2a2a2a] border border-[#444] rounded-md p-2 text-gray-100 cursor-pointer" />
    <input type="file" name="file2" accept="image/*,video/*" 
           class="w-full mb-3 bg-[#2a2a2a] border border-[#444] rounded-md p-2 text-gray-100 cursor-pointer" />
    <input type="file" name="file3" accept="image/*,video/*" 
           class="w-full bg-[#2a2a2a] border border-[#444] rounded-md p-2 text-gray-100 cursor-pointer" />
    <p class="text-xs text-gray-400 mt-1">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ ‡∏Ç‡∏ô‡∏≤‡∏î‡∏£‡∏ß‡∏°‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 50MB</p>
  </div>

  <div class="mb-5">
    <label for="uploader" class="block mb-1 font-semibold">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡πâ‡∏≠‡∏á (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
    <input id="uploader" name="uploader" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì"
           class="w-full bg-[#2a2a2a] border border-[#444] rounded-md p-3 text-gray-100 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500" />
  </div>

  <button type="submit" 
          class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded-md transition"
          aria-label="‡∏™‡πà‡∏á‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ">
    ‡∏™‡πà‡∏á‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ
  </button>
</form>
<!-- ... -->

  </div>

  <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ -->
  <div class="max-w-4xl mx-auto mt-20 px-4 space-y-8 pb-20">
  {% for post in posts %}
  <article class="bg-[#1f1f1f] rounded-xl shadow p-6">
    <h3 class="text-xl font-bold text-red-400 mb-3">{{ post.title }}</h3>
    <p class="mb-4 whitespace-pre-line text-gray-300 leading-relaxed">{{ post.content }}</p>
    <p class="text-sm italic text-gray-500 mb-4">
      ‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÇ‡∏î‡∏¢: {{ post.uploader or '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠' }}<br/>
      ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: {{ post.created_at.strftime('%d/%m/%Y ‡πÄ‡∏ß‡∏•‡∏≤ %H:%M') }}
    </p>

    {% if post.media_urls %}
      <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
        {% for url in post.media_urls %}
          {% if url %}
            {% set ext = url.rsplit('.', 1)[-1].lower() %}
            {% if ext in ['mp4', 'mov', 'avi'] %}
              <video controls class="w-full h-40 rounded-md cursor-pointer hover:scale-105 transition-transform"
                     onclick="openGalleryVideo('{{ url }}')">
                <source src="{{ url }}" type="video/{{ 'mp4' if ext == 'mp4' else 'quicktime' if ext == 'mov' else 'x-msvideo' }}">
                Your browser does not support the video tag.
              </video>
            {% elif ext == 'pdf' %}
              <a href="{{ url }}" target="_blank" class="block p-4 bg-gray-800 rounded-md text-center text-red-500 font-semibold hover:bg-red-700 transition">
                ‡∏î‡∏π‡πÑ‡∏ü‡∏•‡πå PDF
              </a>
            {% else %}
              <img src="{{ url }}" alt="‡∏†‡∏≤‡∏û‡πÅ‡∏ô‡∏ö {{ loop.index }}" 
                   class="w-full h-40 object-cover rounded-md cursor-pointer hover:scale-105 transition-transform"
                   onclick="openGalleryImages({{ post.media_urls | tojson | safe }}, {{ loop.index0 }})" />
            {% endif %}
          {% endif %}
        {% endfor %}
      </div>
    {% endif %}

    <!-- ‡πÑ‡∏•‡∏Ñ‡πå / ‡∏î‡∏¥‡∏™‡πÑ‡∏•‡∏Ñ‡πå -->
    <div class="flex gap-6 text-gray-400 text-lg">
      <button onclick="votePost('{{ post._id }}', 'like')" class="hover:text-green-500 flex items-center gap-1" type="button">
        üëç <span id="likes-{{ post._id }}">{{ post.likes or 0 }}</span>
      </button>
      <button onclick="votePost('{{ post._id }}', 'dislike')" class="hover:text-red-500 flex items-center gap-1" type="button">
        üëé <span id="dislikes-{{ post._id }}">{{ post.dislikes or 0 }}</span>
      </button>
    </div>

  </article>
  {% endfor %}
</div>

<!-- Lightbox modal -->
<div id="galleryModal" onclick="closeGallery()" 
     class="fixed inset-0 bg-black bg-opacity-90 hidden z-50 flex items-center justify-center p-4">
  <div onclick="event.stopPropagation()" 
       class="max-w-6xl w-full bg-black p-4 rounded-lg relative flex flex-col items-center justify-center">

    <button onclick="closeGallery()" 
            class="absolute top-2 right-4 text-white text-4xl font-bold hover:text-red-500"
            aria-label="‡∏õ‡∏¥‡∏î‡πÅ‡∏Å‡∏•‡πÄ‡∏•‡∏≠‡∏£‡∏µ">&times;</button>

    <img id="galleryImage"
         class="max-h-[85vh] max-w-full rounded shadow object-contain hidden" />

    <video id="galleryVideo" controls
           class="max-h-[85vh] max-w-full rounded shadow hidden"
           onclick="event.stopPropagation()">
      <source id="galleryVideoSource" src="" type="video/mp4">
      Your browser does not support the video tag.
    </video>

    <div id="navButtons" class="flex space-x-6 mt-4 hidden">
      <button onclick="prevImage()" class="text-white text-lg px-4 py-2 bg-gray-700 rounded hover:bg-red-600 transition">‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>
      <button onclick="nextImage()" class="text-white text-lg px-4 py-2 bg-gray-700 rounded hover:bg-red-600 transition">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
    </div>
  </div>
</div>



  <script>
    // toggle ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ opacity ‡πÅ‡∏ó‡∏ô hidden
    function toggleForm() {
      const form = document.getElementById("formOverlay");
      const isVisible = !form.classList.contains("opacity-0");

      if (isVisible) {
        form.classList.add("opacity-0", "pointer-events-none");
      } else {
        form.classList.remove("opacity-0", "pointer-events-none");
        window.scrollTo({ top: 0, behavior: "smooth" });
      }
    }

    let currentGallery = [];
    let currentIndex = 0;
    const galleryModal = document.getElementById('galleryModal');
    const galleryImage = document.getElementById('galleryImage');
    const galleryVideo = document.getElementById('galleryVideo');
    const galleryVideoSource = document.getElementById('galleryVideoSource');

function openGalleryImages(urls, startIndex = 0) {
  currentGallery = urls.filter(url => {
    if (!url) return false;
    const ext = url.split('.').pop().toLowerCase();
    return ['png','jpg','jpeg','gif','webp'].includes(ext);
  });
  if(currentGallery.length === 0) return;

  currentIndex = startIndex;
  galleryVideo.classList.add('hidden');
  galleryVideo.pause();
  galleryImage.classList.remove('hidden');
  galleryImage.src = currentGallery[currentIndex];
  document.getElementById('navButtons').classList.remove('hidden');
  galleryModal.classList.remove('hidden');
  document.body.style.overflow = 'hidden';
}

function openGalleryVideo(url) {
  galleryImage.classList.add('hidden');
  galleryVideoSource.src = url;
  galleryVideo.load();
  galleryVideo.classList.remove('hidden');
  document.getElementById('navButtons').classList.add('hidden');
  galleryModal.classList.remove('hidden');
  document.body.style.overflow = 'hidden';
}


    function openGalleryVideo(url) {
      galleryImage.classList.add('hidden');
      galleryVideoSource.src = url;
      galleryVideo.load();
      galleryVideo.classList.remove('hidden');
      galleryModal.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }

    function closeGallery() {
      galleryModal.classList.add('hidden');
      galleryVideo.pause();
      document.body.style.overflow = '';
    }

    function prevImage() {
      if (galleryImage.classList.contains('hidden')) return; // ‡∏ñ‡πâ‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏î‡πâ
      if (currentIndex > 0) {
        currentIndex--;
        galleryImage.src = currentGallery[currentIndex];
      }
    }

    function nextImage() {
      if (galleryImage.classList.contains('hidden')) return;
      if (currentIndex < currentGallery.length - 1) {
        currentIndex++;
        galleryImage.src = currentGallery[currentIndex];
      }
    }

    document.addEventListener('keydown', function(e) {
      if (galleryModal.classList.contains('hidden')) return;
      if (e.key === "Escape") closeGallery();
      if (e.key === "ArrowLeft") prevImage();
      if (e.key === "ArrowRight") nextImage();
    });
  </script>
<script>
  function votePost(postId, voteType) {
    fetch('/api/posts/vote', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ post_id: postId, vote_type: voteType })
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        document.getElementById(`likes-${postId}`).textContent = data.likes;
        document.getElementById(`dislikes-${postId}`).textContent = data.dislikes;
      } else {
        alert(data.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏ß‡∏ï');
      }
    })
    .catch(() => alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠'));
  }
</script>
</body>
</html>
