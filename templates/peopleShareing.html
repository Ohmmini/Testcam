<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>peopleSharing</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #121212;
      color: #E0E0E0;
      font-family: sans-serif;
    }
    .hidden { display: none !important; }

    .active {
      font-weight: bold;
      box-shadow: 0 0 5px #ef4444;
    }

    /* Form overlay ‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏° */
    #formOverlay {
      position: fixed; inset: 0;
      background-color: rgba(18,18,18,0.95);
      z-index: 9999;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 1rem;
      overflow-y: auto;
    }
    /* Popup overlay ‡πÄ‡∏Ç‡πâ‡∏° */
    #popupOverlay {
      position: fixed; inset: 0;
      background-color: rgba(0,0,0,0.9);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 99999;
      overflow: auto;
      padding: 1rem;
    }

    /* Form dark tone */
    form {
      width: 100%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      background-color: #1f1f1f;
      color: #EEE;
      border-radius: 0.5rem;
      padding: 2rem;
      position: relative;
      box-shadow: 0 10px 20px rgba(0,0,0,0.7);
    }
    form > button[type="button"] {
      position: absolute; top: 0.5rem; right: 0.5rem;
      background: transparent; border: none;
      font-size: 1.5rem; color: #AAA;
      cursor: pointer;
    }
    form > button[type="button"]:hover {
      color: #EF4444;
    }
    form input, form select, form textarea {
      background-color: #2a2a2a;
      border: 1px solid #444;
      color: #EEE;
      border-radius: 0.375rem;
      padding: 0.5rem;
      width: 100%;
      margin-top: 0.25rem;
      margin-bottom: 1rem;
    }
    form input::placeholder, form textarea::placeholder {
      color: #888;
    }
    form button[type="submit"] {
      background-color: #333;
      color: #EEE;
      padding: 0.75rem;
      width: 100%;
      border: none;
      border-radius: 0.375rem;
      cursor: pointer;
    }
    form button[type="submit"]:hover {
      background-color: #444;
    }
    #formMap {
      height: 16rem;
      border: 1px solid #444;
      border-radius: 0.375rem;
      margin-bottom: 1rem;
    }

    /* Card styles */
    .card {
      background-color: #1e1e1e;
      color: #DDD;
      border-radius: 0.75rem;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      width: 300px; height: 400px;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.7);
      transition: box-shadow 0.2s;
    }
    .card:hover {
      box-shadow: 0 8px 20px rgba(239,68,68,0.7);
    }
    .truncate-multiline-3 {
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
    }
    .media {
      height: 12rem;
      border-radius: 0.5rem;
      overflow: hidden;
      position: relative;
    }
    .media img, .media video {
      width: 100%; height: 100%;
      object-fit: cover;
    }

    /* ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö‡∏Ç‡∏¢‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤ */
    .back-button {
      position: fixed;
      top: 1rem;
      left: 3rem;
      z-index: 50;
    }
    .back-button a {
      font-size: 2rem;
      color: #EEE;
      text-decoration: none;
    }
  </style>
</head>
<body>

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏° -->
  <button onclick="toggleForm()" title="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà"
    class="fixed bottom-6 right-6 w-14 h-14 rounded-full bg-red-600 text-white text-3xl shadow-lg hover:bg-red-700 z-50">
    +
  </button>

  <!-- Form overlay -->
  <div id="formOverlay" class="hidden" onclick="if(event.target===this) toggleForm();">
    <form method="POST" enctype="multipart/form-data" onclick="event.stopPropagation();">
      <button type="button" onclick="toggleForm()">√ó</button>
      <h2 class="text-2xl font-bold mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà / ‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h2>

      <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
      <select name="category" required>
        <option value="" disabled selected>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
        <option value="‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£">‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£</option>
        <option value="‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß</option>
      </select>

      <label>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà/‡∏£‡πâ‡∏≤‡∏ô</label>
      <input name="name" type="text" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ß‡∏±‡∏î‡∏û‡∏£‡∏∞‡∏ò‡∏≤‡∏ï‡∏∏‡∏î‡∏≠‡∏¢‡∏Å‡∏≠‡∏á‡∏°‡∏π" />

      <label>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢</label>
      <textarea name="description" rows="3" required placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°"></textarea>

      <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏à‡∏≤‡∏Å‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</label>
      <div id="formMap"></div>
      <input type="hidden" id="latitude" name="latitude" />
      <input type="hidden" id="longitude" name="longitude" />

      <label>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ 1</label>
      <input type="file" name="file1" accept="image/*,video/*" required />

      <label>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ 2</label>
      <input type="file" name="file2" accept="image/*,video/*" />

      <label>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ 3</label>
      <input type="file" name="file3" accept="image/*,video/*" />

      <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
      <input name="phone" type="tel" placeholder="0812345678 ‡∏´‡∏£‡∏∑‡∏≠ +66812345678" />

      <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÇ‡∏û‡∏™‡∏ï‡πå (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
      <input name="uploader" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" />

      <button type="submit">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </form>
  </div>

  <!-- ‡πÅ‡∏ñ‡∏ö‡∏ö‡∏ô: ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö + ‡∏ü‡∏¥‡∏•‡πÄ‡∏ï‡∏≠‡∏£‡πå -->
  <div class="max-w-7xl mx-auto mt-6 px-4 flex items-center justify-between">
    <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö -->
    <a href="/opening" id="back-button">&lt;</a>
    <!-- ‡∏ü‡∏¥‡∏•‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÅ‡∏ö‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° -->
    <div class="flex gap-4 text-sm text-gray-400">
      <button class="filter-btn active text-red-400 font-semibold" data-category="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
      <button class="filter-btn hover:text-white" data-category="‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£">‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£</button>
      <button class="filter-btn hover:text-white" data-category="‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß</button>
    </div>
  </div>

  <!-- ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏Å‡∏≤‡∏£‡πå‡∏î -->
  <div class="max-w-7xl mx-auto mt-8 px-4">
    <div class="flex flex-wrap gap-6 justify-center md:justify-start">
      {% for profile in profiles %}
        <div class="card" data-category="{{ profile.category }}">
  <div>
    <h3 class="text-xl font-bold mb-1">{{ profile.name }}</h3>
    <p class="text-sm mb-1">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: {{ profile.category }}</p>
    <p class="text-sm mb-2 truncate-multiline-3">{{ profile.description }}</p>
  </div>

 <div class="media" style="display: grid; grid-template-columns: repeat(2, 1fr); grid-template-rows: 6rem 6rem; gap: 0.5rem;">
  {% if profile.media_urls and profile.media_urls|length > 0 %}
    {% for media_url in profile.media_urls %}
      {% set ext = media_url.rsplit('.', 1)[-1].lower() %}

      {% if loop.index == 1 %}
        <div class="media-preview"
             data-media='{{ profile.media_urls | tojson | safe }}'
             data-index='{{ loop.index0 }}'
             style="grid-column: 1 / span 2; height: 6rem; border-radius: 0.5rem; overflow: hidden; cursor: pointer;">
          {% if ext in ['mp4', 'webm', 'ogg'] %}
            <video autoplay muted loop playsinline
                   style="width: 100%; height: 100%; object-fit: cover;">
              <source src="{{ media_url }}" type="video/{{ ext }}">
            </video>
          {% else %}
            <img src="{{ media_url }}" alt="‡∏£‡∏π‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà"
                 style="width: 100%; height: 100%; object-fit: cover;" />
          {% endif %}
        </div>
      {% elif loop.index <= 3 %}
        <div class="media-preview"
             data-media='{{ profile.media_urls | tojson | safe }}'
             data-index='{{ loop.index0 }}'
             style="height: 6rem; border-radius: 0.5rem; overflow: hidden; cursor: pointer;">
          {% if ext in ['mp4', 'webm', 'ogg'] %}
            <video autoplay muted loop playsinline
                   style="width: 100%; height: 100%; object-fit: cover;">
              <source src="{{ media_url }}" type="video/{{ ext }}">
            </video>
          {% else %}
            <img src="{{ media_url }}" alt="‡∏£‡∏π‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà"
                 style="width: 100%; height: 100%; object-fit: cover;" />
          {% endif %}
        </div>
      {% endif %}
    {% endfor %}
  {% endif %}
</div>




  <div class="mt-2">
    <p class="text-xs mb-2">üìû {{ profile.phone }}</p>
    <p class="text-xs italic mb-1">‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÇ‡∏î‡∏¢: {{ profile.uploader or '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠' }}</p>
    <p class="text-xs">
      <a href="https://www.google.com/maps?q={{ profile.latitude }},{{ profile.longitude }}" target="_blank" class="text-blue-400 underline">
        üó∫Ô∏è ‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏ö‡∏ô Google Maps
      </a>
    </p>
  </div>
</div>

      {% endfor %}
    </div>
  </div>

  <!-- Popup -->
  <div id="popupOverlay" onclick="hidePopup()"></div>

  <script>
    // ‡∏™‡∏£‡πâ‡∏≤‡∏á Leaflet map ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°
    let formMap = L.map('formMap').setView([19.3, 97.966], 9);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(formMap);

    function toggleForm() {
      const formOverlay = document.getElementById('formOverlay');
      formOverlay.classList.toggle('hidden');
      if (!formOverlay.classList.contains('hidden')) {
        setTimeout(() => formMap.invalidateSize(), 200);
      }
    }

    let marker;
    formMap.on('click', function(e){
      document.getElementById('latitude').value = e.latlng.lat.toFixed(6);
      document.getElementById('longitude').value = e.latlng.lng.toFixed(6);
      if (marker) marker.setLatLng(e.latlng);
      else marker = L.marker(e.latlng).addTo(formMap);
    });

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î popup ‡∏£‡∏π‡∏õ‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠
    function openPopup(mediaUrls) {
      const popupOverlay = document.getElementById('popupOverlay');
      popupOverlay.innerHTML = '';

      if (!Array.isArray(mediaUrls) || mediaUrls.length === 0) {
        popupOverlay.style.display = 'none';
        return;
      }

      mediaUrls.forEach(src => {
        const ext = src.split('.').pop().toLowerCase();

        let mediaElem;
        if (['mp4', 'webm', 'ogg'].includes(ext)) {
          mediaElem = document.createElement('video');
          mediaElem.src = src;
          mediaElem.autoplay = true;
          mediaElem.muted = true;
          mediaElem.loop = true;
          mediaElem.playsInline = true;
          mediaElem.controls = true; // ‡πÄ‡∏û‡∏¥‡πà‡∏° controls ‡πÉ‡∏´‡πâ‡∏Å‡∏î‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏î‡πâ
        } else {
          mediaElem = document.createElement('img');
          mediaElem.src = src;
          mediaElem.alt = '‡∏£‡∏π‡∏õ‡πÄ‡∏ï‡πá‡∏°';
        }

        // ‡∏ï‡∏±‡πâ‡∏á style
        mediaElem.style.maxWidth = '90%';
        mediaElem.style.maxHeight = '90%';
        mediaElem.style.borderRadius = '8px';
        mediaElem.style.boxShadow = '0 0 10px white';
        mediaElem.style.cursor = 'pointer';
        mediaElem.style.margin = '0.5rem';

        // ‡∏Å‡∏î‡∏õ‡∏¥‡∏î popup ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏ó‡∏µ‡πà media
        mediaElem.addEventListener('click', hidePopup);
        popupOverlay.appendChild(mediaElem);
      });

      popupOverlay.style.display = 'flex';
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏¥‡∏î popup
    function hidePopup() {
      const popupOverlay = document.getElementById('popupOverlay');
      popupOverlay.style.display = 'none';
      popupOverlay.innerHTML = ''; // ‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏£‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πå‡∏î (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)
    const filterButtons = document.querySelectorAll('.filter-btn');
    const cards = document.querySelectorAll('.card');

    filterButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        filterButtons.forEach(b => b.classList.remove('active', 'text-red-400', 'font-semibold'));
        btn.classList.add('active', 'text-red-400', 'font-semibold');

        const category = btn.getAttribute('data-category');

        cards.forEach(card => {
          if (category === 'all' || card.getAttribute('data-category') === category) {
            card.style.display = 'flex';
          } else {
            card.style.display = 'none';
          }
        });
      });
    });

    function openPopupAt(mediaUrls, index, event) {
  event.stopPropagation(); // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô event ‡∏•‡∏∏‡∏Å‡∏•‡∏≤‡∏°
  const popupOverlay = document.getElementById('popupOverlay');
  popupOverlay.innerHTML = '';

  if (!Array.isArray(mediaUrls) || mediaUrls.length === 0 || index < 0 || index >= mediaUrls.length) {
    popupOverlay.style.display = 'none';
    return;
  }

  const src = mediaUrls[index];
  const ext = src.split('.').pop().toLowerCase();

  let mediaElem;
  if (['mp4', 'webm', 'ogg'].includes(ext)) {
    mediaElem = document.createElement('video');
    mediaElem.src = src;
    mediaElem.autoplay = true;
    mediaElem.muted = true;
    mediaElem.loop = true;
    mediaElem.playsInline = true;
    mediaElem.controls = true;
  } else {
    mediaElem = document.createElement('img');
    mediaElem.src = src;
    mediaElem.alt = '‡∏£‡∏π‡∏õ‡πÄ‡∏ï‡πá‡∏°';
  }

  mediaElem.style.maxWidth = '90%';
  mediaElem.style.maxHeight = '90%';
  mediaElem.style.borderRadius = '8px';
  mediaElem.style.boxShadow = '0 0 10px white';
  mediaElem.style.cursor = 'pointer';
  mediaElem.style.margin = '0.5rem';

  mediaElem.addEventListener('click', () => {
    document.getElementById('popupOverlay').style.display = 'none';
    document.getElementById('popupOverlay').innerHTML = '';
  });

  popupOverlay.appendChild(mediaElem);
  popupOverlay.style.display = 'flex';
}



  </script>
  <script>
  // ‡∏î‡∏±‡∏Å‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏∏‡∏Å .media-preview ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏¥‡∏î popup
  document.querySelectorAll('.media-preview').forEach(el => {
    el.addEventListener('click', function(event) {
      event.stopPropagation(); // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏∞‡∏•‡∏∏
      try {
        const media = JSON.parse(this.dataset.media);
        const index = parseInt(this.dataset.index);
        openPopupAt(media, index, event);
      } catch (err) {
        console.error("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î popup ‡πÑ‡∏î‡πâ:", err);
      }
    });
  });
</script>

</body>
</html>
